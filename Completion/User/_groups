#compdef newgrp

local expl groups tmp

_wanted groups expl group || return 1

if ! zstyle -a ":completion:${curcontext}:" groups groups; then
  (( $+_cache_groups )) ||
      if (( ${+commands[ypcat]} )) &&
	  tmp=$(_call groups ypcat group.byname); then
        : ${(A)_cache_groups:=${${(f)tmp}%%:*}} # If you use YP
      else
        : ${(A)_cache_groups:=${${(s: :)$(</etc/group)}%%:*}}
      fi

  groups=( "$_cache_groups[@]" )
fi

compadd "$@" "$expl[@]" - "$groups[@]"
