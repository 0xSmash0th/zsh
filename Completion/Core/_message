#autoload

local format

_tags messages || return 1

zstyle -s ":completion:${curcontext}:messages" format format ||
    zstyle -s ":completion:${curcontext}:descriptions" format format

if [[ -n "$format" ]]; then
  zformat -f format "$format" "d:$1" "${(@)argv[2,-1]}"
  if [[ $compstate[nmatches] -eq 0 ]]; then
    compstate[list]='list force'
    compstate[insert]=''
    compadd -UX "${format}" -n ''
  else
    compadd -X "${format}" -n '' && compstate[list]='list force'
  fi
fi
